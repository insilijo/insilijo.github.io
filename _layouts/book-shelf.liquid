---
layout: page
---
{{ content }}

{% if page.collection and page.collection.size > 0 %}
  {% assign collection = site[page.collection] %}
{% endif %}

{% if collection and collection.size > 0 %}
  {%- comment -%}
    Collect all unique categories from books and count occurrences
    Handles both YAML array format and space-separated string format
    Filters out empty strings and invalid values
  {%- endcomment -%}
  {% assign all_categories = '' | split: '' %}
  {% assign category_counts = '' | split: '' %}

  {%- comment -%} First, collect all unique categories {%- endcomment -%}
  {% for item in collection %}
    {% if item.categories %}
      {% if item.categories.first %}
        {%- comment -%} It's already an array (YAML list format) {%- endcomment -%}
        {% assign item_categories = item.categories %}
      {% else %}
        {%- comment -%} It's a string, split by spaces {%- endcomment -%}
        {% assign item_categories = item.categories | split: ' ' %}
      {% endif %}
      {% for cat in item_categories %}
        {% assign cat_trimmed = cat | strip %}
        {% if cat_trimmed != '' and cat_trimmed != '[]' and cat_trimmed != '[' and cat_trimmed != ']' %}
          {% unless all_categories contains cat_trimmed %}
            {% assign all_categories = all_categories | push: cat_trimmed %}
          {% endunless %}
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endfor %}

  {%- comment -%} Count books for each category {%- endcomment -%}
  {% for category in all_categories %}
    {% assign count = 0 %}
    {% for item in collection %}
      {% if item.categories %}
        {% if item.categories.first %}
          {% assign item_categories = item.categories %}
        {% else %}
          {% assign item_categories = item.categories | split: ' ' %}
        {% endif %}
        {% for cat in item_categories %}
          {% assign cat_trimmed = cat | strip %}
          {% if cat_trimmed == category %}
            {% assign count = count | plus: 1 %}
            {% break %}
          {% endif %}
        {% endfor %}
      {% endif %}
    {% endfor %}
    {% assign category_counts = category_counts | push: count %}
  {% endfor %}

  {%- comment -%} Keep categories and counts in parallel arrays - JavaScript will sort them {%- endcomment -%}
  {% assign sorted_categories = all_categories %}
  {% assign sorted_counts = category_counts %}

  {%- comment -%}
    Searchable multiselect dropdown for tags
  {%- endcomment -%}
  {% if all_categories.size > 0 %}
    <div class="book-filter-container" style="margin-bottom: 2rem; position: relative; max-width: 400px;">
      <div class="book-filter-dropdown">
        <div class="book-filter-input-wrapper" style="position: relative;">
          <input
            type="text"
            id="book-filter-search"
            class="book-filter-search"
            placeholder="Search and filter by tags..."
            autocomplete="off"
            style="width: 100%; padding: 0.5rem 2.5rem 0.5rem 1rem; border: 1px solid var(--global-divider-color); background: var(--global-bg-color); color: var(--global-text-color); border-radius: 4px; font-size: 0.9rem;"
          >
          <span
            class="book-filter-icon"
            style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); pointer-events: none; color: var(--global-text-color-light);"
          >
            <i class="fa-solid fa-chevron-down"></i>
          </span>
        </div>
        <div
          class="book-filter-dropdown-menu"
          id="book-filter-dropdown-menu"
          style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 0.25rem; background: var(--global-bg-color); border: 1px solid var(--global-divider-color); border-radius: 4px; max-height: 300px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"
        >
          <div class="book-filter-options" id="book-filter-options">
            {% for i in (0..sorted_categories.size) %}
              {% if i < sorted_categories.size %}
                {% assign category = sorted_categories[i] %}
                {% assign count = sorted_counts[i] %}
                <label
                  class="book-filter-option"
                  style="display: flex; align-items: center; justify-content: space-between; padding: 0.5rem 1rem; cursor: pointer; transition: background 0.2s;"
                  data-category="{{ category }}"
                  data-count="{{ count }}"
                >
                  <span style="display: flex; align-items: center;">
                    <input
                      type="checkbox"
                      class="book-filter-checkbox"
                      value="{{ category }}"
                      style="margin-right: 0.5rem;"
                    >
                    <span>{{ category | replace: '-', ' ' | capitalize }}</span>
                  </span>
                  <span style="color: var(--global-text-color-light); font-size: 0.85rem; margin-left: 0.5rem;">{{ count }}</span>
                </label>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
      <div
        class="book-filter-selected"
        id="book-filter-selected"
        style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem; min-height: 1.5rem; align-items: center;"
      >
        <!-- Selected tags will appear here -->
        <button
          id="book-filter-clear"
          class="book-filter-clear-btn"
          style="display: none; padding: 0.25rem 0.75rem; background: var(--global-text-color-light); color: var(--global-bg-color); border: 1px solid var(--global-divider-color); border-radius: 4px; font-size: 0.85rem; cursor: pointer; transition: all 0.2s;"
          title="Clear all filters"
        >
          Clear all
        </button>
      </div>
    </div>
  {% endif %}
  {%- comment -%}
    =========================
    READING (CURRENTLY READING)
    =========================
  {%- endcomment -%}

  {% assign has_reading = false %}
  {% for item in collection %}
    {% if item.status %}
      {% assign status = item.status | downcase | strip %}
      {% if status == 'reading' %}
        {% assign has_reading = true %}
        {% break %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% if has_reading %}
    <h1>Reading</h1>
    <ul class="reading">
      {% for item in collection reversed %}
        {% if item.status %}
          {% assign status = item.status | downcase | strip %}
          {% if status == 'reading' %}
            <figure
              class="cover book-item"
              {% if item.categories %}
                {%- if item.categories.first -%}
                  data-categories="{{ item.categories | join: ' ' }}"
                {%- else -%}
                  data-categories="{{ item.categories }}"
                {%- endif -%}
              {% endif %}
            >
              <a class="cover-link" href="{{ item.url | relative_url }}">
                {% if item.cover %}
                  <img
                    alt="{{ item.title }} cover"
                    src="{{ item.cover | prepend: page.covers | relative_url }}"
                    style="height:200px"
                  >
                {% elsif item.olid %}
                  <img
                    alt="{{ item.title }} cover"
                    src="http://covers.openlibrary.org/b/olid/{{ item.olid }}-L.jpg?default=false"
                    style="height:200px"
                  >
                {% elsif item.isbn %}
                  <img
                    alt="{{ item.title }} cover"
                    src="http://covers.openlibrary.org/b/isbn/{{ item.isbn }}-L.jpg?default=false"
                    style="height:200px"
                  >
                {% endif %}

                {% if item.status %}
                  {% assign statuses = 'abandoned,finished,interested,paused,queued,reading,reread' | split: ',' %}
                  {% assign status = item.status | downcase | strip %}
                  {% if statuses contains status %}
                    <figcaption class="{{ status }}">{{ status | upcase }}</figcaption>
                  {% else %}
                    <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
                  {% endif %}
                {% else %}
                  <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
                {% endif %}
              </a>
            </figure>
          {% endif %}
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}

  {%- comment -%}
    =========================
    FAVORITES (PINNED AT TOP)
    =========================
  {%- endcomment -%}

  {% assign has_favorites = false %}
  {% for item in collection %}
    {% if item.favorite == true %}
      {% assign has_favorites = true %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% if has_favorites %}
    <h1>Favorites</h1>
    <ul class="favorites">
      {% for item in collection reversed %}
        {% if item.favorite == true %}
          <figure
            class="cover book-item"
            {% if item.categories %}
              {%- if item.categories.first -%}
                data-categories="{{ item.categories | join: ' ' }}"
              {%- else -%}
                data-categories="{{ item.categories }}"
              {%- endif -%}
            {% endif %}
          >
            <a class="cover-link" href="{{ item.url | relative_url }}">
              {% if item.cover %}
                <img
                  alt="{{ item.title }} cover"
                  src="{{ item.cover | prepend: page.covers | relative_url }}"
                  style="height:200px"
                >
              {% elsif item.olid %}
                <img
                  alt="{{ item.title }} cover"
                  src="http://covers.openlibrary.org/b/olid/{{ item.olid }}-L.jpg?default=false"
                  style="height:200px"
                >
              {% elsif item.isbn %}
                <img
                  alt="{{ item.title }} cover"
                  src="http://covers.openlibrary.org/b/isbn/{{ item.isbn }}-L.jpg?default=false"
                  style="height:200px"
                >
              {% endif %}

              {% if item.status %}
                {% assign statuses = 'abandoned,finished,interested,paused,queued,reading,reread' | split: ',' %}
                {% assign status = item.status | downcase | strip %}
                {% if statuses contains status %}
                  <figcaption class="{{ status }}">{{ status | upcase }}</figcaption>
                {% else %}
                  <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
                {% endif %}
              {% else %}
                <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
              {% endif %}
            </a>
          </figure>
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}

  {%- comment -%}
    =========================
    NON-FAVORITES (BY YEAR)
    =========================
  {%- endcomment -%}

  {% assign year = null %}
  {% for item in collection reversed %}
    {% assign is_reading = false %}
    {% if item.status %}
      {% assign status = item.status | downcase | strip %}
      {% if status == 'reading' %}
        {% assign is_reading = true %}
      {% endif %}
    {% endif %}
    {% unless item.favorite == true or is_reading == true %}
      {% assign current_year = item.date | date: '%Y' %}

      {% if current_year != year %}
        {% unless forloop.first %}
          </ul>
        {% endunless %}
        <h1 id="y{{ current_year }}">
          <a href="{{ current_year | prepend: '/books/' | relative_url }}">{{ current_year }}</a>
        </h1>
        <ul>
          {% assign year = current_year %}
      {% endif %}

      <figure
        class="cover book-item"
        {% if item.categories %}
          {%- if item.categories.first -%}
            data-categories="{{ item.categories | join: ' ' }}"
          {%- else -%}
            data-categories="{{ item.categories }}"
          {%- endif -%}
        {% endif %}
      >
        <a class="cover-link" href="{{ item.url | relative_url }}">
          {% if item.cover %}
            <img
              alt="{{ item.title }} cover"
              src="{{ item.cover | prepend: page.covers | relative_url }}"
              style="height:200px"
            >
          {% elsif item.olid %}
            <img
              alt="{{ item.title }} cover"
              src="http://covers.openlibrary.org/b/olid/{{ item.olid }}-L.jpg?default=false"
              style="height:200px"
            >
          {% elsif item.isbn %}
            <img
              alt="{{ item.title }} cover"
              src="http://covers.openlibrary.org/b/isbn/{{ item.isbn }}-L.jpg?default=false"
              style="height:200px"
            >
          {% endif %}

          {% if item.status %}
            {% assign statuses = 'abandoned,finished,interested,paused,queued,reading,reread' | split: ',' %}
            {% assign status = item.status | downcase | strip %}
            {% if statuses contains status %}
              <figcaption class="{{ status }}">{{ status | upcase }}</figcaption>
            {% else %}
              <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
            {% endif %}
          {% else %}
            <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
          {% endif %}
        </a>
      </figure>
    {% endunless %}
  {% endfor %}
  </ul>
{% endif %}

<script src="{{ '/assets/js/book-filter.js' | relative_url | bust_file_cache }}" type="text/javascript"></script>

<style>
  /* Page Header Styling */
  .bookshelf-page-header {
    margin-bottom: 3rem;
    padding: 1.5rem 0 2rem 0;
    position: relative;
  }

  .bookshelf-page-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--global-theme-color);
    opacity: 0.8;
  }

  .bookshelf-header-content {
    position: relative;
    z-index: 1;
  }

  .bookshelf-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--global-text-color);
    letter-spacing: -0.02em;
    line-height: 1.2;
  }

  .bookshelf-description {
    font-size: 1.1rem;
    color: var(--global-text-color-light);
    margin: 0;
    font-style: italic;
  }

  /* Enhanced details/summary styling */
  details {
    margin: 2rem 0;
    padding: 1.5rem;
    background: var(--global-bg-color);
    border: 1px solid var(--global-divider-color);
    border-left: 3px solid var(--global-theme-color);
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  details:hover {
    border-color: var(--global-theme-color);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transform: translateY(-2px);
  }

  details[open] {
    border-color: var(--global-theme-color);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
  }

  summary {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--global-theme-color);
    cursor: pointer;
    padding: 0.5rem 0;
    user-select: none;
    transition: color 0.2s ease;
    list-style: none;
  }

  summary::-webkit-details-marker {
    display: none;
  }

  summary::before {
    content: 'â–¶';
    display: inline-block;
    margin-right: 0.5rem;
    transition: transform 0.2s ease;
    font-size: 0.8em;
    color: var(--global-theme-color);
  }

  details[open] summary::before {
    transform: rotate(90deg);
  }

  summary:hover {
    color: var(--global-text-color);
  }

  details[open] summary {
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--global-divider-color);
  }

  /* Content area styling */
  .post {
    animation: fadeIn 0.6s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Enhanced typography in content */
  .post article {
    line-height: 1.8;
  }

  .post article p {
    margin-bottom: 1.25rem;
  }

  .post article em {
    font-style: italic;
    color: var(--global-text-color);
  }

  .post article br + br {
    margin-top: 1rem;
  }

  .book-filter-dropdown {
    position: relative;
  }

  .book-filter-input-wrapper input {
    border: 2px solid var(--global-divider-color) !important;
    transition: all 0.3s ease;
  }

  .book-filter-input-wrapper input:focus {
    border-color: var(--global-theme-color) !important;
    box-shadow: 0 0 0 3px rgba(0, 159, 6, 0.1) !important;
    outline: none;
  }

  .book-filter-dropdown-menu {
    border: 1px solid var(--global-divider-color) !important;
    border-top: 2px solid var(--global-theme-color) !important;
  }

  .book-filter-option {
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
  }

  .book-filter-option:hover {
    background: var(--global-hover-color) !important;
    border-left-color: var(--global-theme-color);
    transform: translateX(4px);
  }

  .book-filter-option input[type='checkbox']:checked + span {
    font-weight: 600;
    color: var(--global-theme-color);
  }

  .book-filter-chip {
    background: var(--global-theme-color) !important;
    transition: all 0.3s ease;
  }

  .book-filter-chip:hover {
    opacity: 0.9;
    transform: translateY(-2px);
  }

  .book-filter-chip-remove:hover {
    opacity: 1 !important;
  }

  .book-filter-clear-btn:hover {
    background: var(--global-theme-color) !important;
    color: var(--global-bg-color) !important;
    border-color: var(--global-theme-color) !important;
  }

  .book-item.hidden {
    display: none;
  }

  .book-item {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: fadeInUp 0.5s ease-out;
    animation-fill-mode: both;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Stagger animation for books */
  .book-item:nth-child(1) {
    animation-delay: 0.05s;
  }
  .book-item:nth-child(2) {
    animation-delay: 0.1s;
  }
  .book-item:nth-child(3) {
    animation-delay: 0.15s;
  }
  .book-item:nth-child(4) {
    animation-delay: 0.2s;
  }
  .book-item:nth-child(5) {
    animation-delay: 0.25s;
  }
  .book-item:nth-child(6) {
    animation-delay: 0.3s;
  }
  .book-item:nth-child(n + 7) {
    animation-delay: 0.35s;
  }

  /* Enhanced book cover styling */
  figure.cover {
    position: relative;
    margin: 0.75rem;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: var(--global-bg-color);
  }

  figure.cover:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    z-index: 10;
  }

  figure.cover a.cover-link {
    display: block;
    position: relative;
    overflow: hidden;
  }

  figure.cover img {
    width: auto;
    height: 200px;
    object-fit: cover;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: block;
    margin: 0 auto;
  }

  figure.cover:hover img {
    transform: scale(1.05);
  }

  /* Overlay effect on hover */
  figure.cover a.cover-link::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.1) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  figure.cover:hover a.cover-link::after {
    opacity: 1;
  }

  /* Enhanced status badges */
  figure.cover figcaption {
    position: relative;
    padding: 0.4rem 0.6rem;
    font-size: 0.75rem;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }

  figure.cover:hover figcaption {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }

  /* Reading section styling */
  .reading {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 2rem;
    padding: 1rem 0;
    border-bottom: 2px solid var(--global-divider-color);
  }

  .reading h1 {
    width: 100%;
    margin-bottom: 1rem;
    color: var(--global-theme-color);
    font-weight: 700;
  }

  .reading .cover {
    border: 2px solid var(--global-theme-color);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
  }

  .reading .cover:hover {
    border-color: var(--global-theme-color);
    box-shadow: 0 8px 28px rgba(0, 0, 0, 0.2);
  }

  /* Favorites section styling */
  .favorites {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 2rem;
    padding: 1rem 0;
    border-bottom: 2px solid var(--global-divider-color);
  }

  .favorites h1 {
    width: 100%;
    margin-bottom: 1rem;
    color: var(--global-theme-color);
    font-weight: 700;
  }

  .favorites .cover {
    border: 2px solid var(--global-theme-color);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
  }

  .favorites .cover:hover {
    border-color: var(--global-theme-color);
    box-shadow: 0 8px 28px rgba(0, 0, 0, 0.2);
  }

  /* Year section headers */
  h1[id^='y'] {
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--global-theme-color);
    font-size: 1.5rem;
    color: var(--global-text-color);
    font-weight: 700;
  }

  h1[id^='y']:first-of-type {
    margin-top: 1rem;
  }

  /* Year links */
  h1[id^='y'] a {
    color: var(--global-text-color);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  h1[id^='y'] a:hover {
    color: var(--global-theme-color);
  }

  /* Book list styling */
  ul:not(.favorites):not(.reading) {
    display: flex;
    flex-wrap: wrap;
    margin: 0;
    padding: 0;
    list-style: none;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    figure.cover {
      margin: 0.5rem;
    }

    figure.cover:hover {
      transform: translateY(-4px) scale(1.01);
    }
  }

  .book-filter-dropdown-menu::-webkit-scrollbar {
    width: 8px;
  }

  .book-filter-dropdown-menu::-webkit-scrollbar-track {
    background: var(--global-bg-color);
  }

  .book-filter-dropdown-menu::-webkit-scrollbar-thumb {
    background: var(--global-divider-color);
    border-radius: 4px;
  }

  .book-filter-dropdown-menu::-webkit-scrollbar-thumb:hover {
    background: var(--global-text-color-light);
  }
</style>
