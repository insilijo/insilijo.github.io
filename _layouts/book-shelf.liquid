---
layout: page
---
{{ content }}

{% if page.collection and page.collection.size > 0 %}
  {% assign collection = site[page.collection] %}
{% endif %}

{% if collection and collection.size > 0 %}
  {%- comment -%}
    Collect all unique categories from books
  {%- endcomment -%}
  {% assign all_categories = '' | split: '' %}
  {% for item in collection %}
    {% if item.categories %}
      {% assign item_categories = item.categories | split: ' ' %}
      {% for cat in item_categories %}
        {% unless all_categories contains cat %}
          {% assign all_categories = all_categories | push: cat %}
        {% endunless %}
      {% endfor %}
    {% endif %}
  {% endfor %}
  {% assign all_categories = all_categories | sort %}

  {%- comment -%}
    Tag filter UI
  {%- endcomment -%}
  {% if all_categories.size > 0 %}
    <div class="book-filter-container" style="margin-bottom: 2rem;">
      <div class="book-filter-buttons" style="display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center;">
        <button class="book-filter-btn active" data-filter="all" style="padding: 0.5rem 1rem; border: 1px solid var(--global-divider-color); background: var(--global-bg-color); color: var(--global-text-color); cursor: pointer; border-radius: 4px; transition: all 0.2s;">
          All
        </button>
        {% for category in all_categories %}
          <button class="book-filter-btn" data-filter="{{ category }}" style="padding: 0.5rem 1rem; border: 1px solid var(--global-divider-color); background: var(--global-bg-color); color: var(--global-text-color); cursor: pointer; border-radius: 4px; transition: all 0.2s;">
            {{ category | replace: '-', ' ' | capitalize }}
          </button>
        {% endfor %}
      </div>
    </div>
  {% endif %}
  {%- comment -%}
    =========================
    FAVORITES (PINNED AT TOP)
    =========================
  {%- endcomment -%}

  {% assign has_favorites = false %}
  {% for item in collection %}
    {% if item.favorite == true %}
      {% assign has_favorites = true %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% if has_favorites %}
    <h1>Favorites</h1>
    <ul class="favorites">
      {% for item in collection reversed %}
        {% if item.favorite == true %}
          <figure class="cover book-item" {% if item.categories %}data-categories="{{ item.categories }}"{% endif %}>
            <a class="cover-link" href="{{ item.url | relative_url }}">
              {% if item.cover %}
                <img
                  alt="{{ item.title }} cover"
                  src="{{ item.cover | prepend: page.covers | relative_url }}"
                  style="height:200px"
                >
              {% elsif item.olid %}
                <img
                  alt="{{ item.title }} cover"
                  src="http://covers.openlibrary.org/b/olid/{{ item.olid }}-L.jpg?default=false"
                  style="height:200px"
                >
              {% elsif item.isbn %}
                <img
                  alt="{{ item.title }} cover"
                  src="http://covers.openlibrary.org/b/isbn/{{ item.isbn }}-L.jpg?default=false"
                  style="height:200px"
                >
              {% endif %}

              {% if item.status %}
                {% assign statuses = 'abandoned,finished,interested,paused,queued,reading,reread' | split: ',' %}
                {% assign status = item.status | downcase | strip %}
                {% if statuses contains status %}
                  <figcaption class="{{ status }}">{{ status | upcase }}</figcaption>
                {% else %}
                  <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
                {% endif %}
              {% else %}
                <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
              {% endif %}
            </a>
          </figure>
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}

  {%- comment -%}
    =========================
    NON-FAVORITES (BY YEAR)
    =========================
  {%- endcomment -%}

  {% assign year = null %}
  {% for item in collection reversed %}
    {% unless item.favorite == true %}
      {% assign current_year = item.date | date: '%Y' %}

      {% if current_year != year %}
        {% unless forloop.first %}
          </ul>
        {% endunless %}
        <h1 id="y{{ current_year }}">
          <a href="{{ current_year | prepend: '/books/' | relative_url }}">{{ current_year }}</a>
        </h1>
        <ul>
          {% assign year = current_year %}
      {% endif %}

      <figure class="cover book-item" {% if item.categories %}data-categories="{{ item.categories }}"{% endif %}>
        <a class="cover-link" href="{{ item.url | relative_url }}">
          {% if item.cover %}
            <img
              alt="{{ item.title }} cover"
              src="{{ item.cover | prepend: page.covers | relative_url }}"
              style="height:200px"
            >
          {% elsif item.olid %}
            <img
              alt="{{ item.title }} cover"
              src="http://covers.openlibrary.org/b/olid/{{ item.olid }}-L.jpg?default=false"
              style="height:200px"
            >
          {% elsif item.isbn %}
            <img
              alt="{{ item.title }} cover"
              src="http://covers.openlibrary.org/b/isbn/{{ item.isbn }}-L.jpg?default=false"
              style="height:200px"
            >
          {% endif %}

          {% if item.status %}
            {% assign statuses = 'abandoned,finished,interested,paused,queued,reading,reread' | split: ',' %}
            {% assign status = item.status | downcase | strip %}
            {% if statuses contains status %}
              <figcaption class="{{ status }}">{{ status | upcase }}</figcaption>
            {% else %}
              <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
            {% endif %}
          {% else %}
            <figcaption class="uncategorized">UNCATEGORIZED</figcaption>
          {% endif %}
        </a>
      </figure>
    {% endunless %}
  {% endfor %}
  </ul>
{% endif %}

<script src="{{ '/assets/js/book-filter.js' | relative_url | bust_file_cache }}" type="text/javascript"></script>

<style>
  .book-filter-btn:hover {
    background: var(--global-theme-color) !important;
    color: var(--global-bg-color) !important;
    border-color: var(--global-theme-color) !important;
  }
  
  .book-filter-btn.active {
    background: var(--global-theme-color) !important;
    color: var(--global-bg-color) !important;
    border-color: var(--global-theme-color) !important;
  }
  
  .book-item.hidden {
    display: none;
  }
  
  .book-item {
    transition: opacity 0.3s ease;
  }
  
  .book-item.filtered-out {
    opacity: 0.3;
    pointer-events: none;
  }
</style>
